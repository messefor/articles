ファイルをバイト単位で比較：cmpコマンド

2つのzipファイルを比較したい場合など、バイナリレベルでファイルを比較したいことがあります。こういう場合は`cmp`コマンドで比較すると良いです。



`FILE1`と`FILE2`を比較したい場合、以下の構文になります。

> cmp FILE1 FILE2

完全に一致していれば、何も出力されず、不一致の場合は

> file1.tar.gz file2.tar.gz differ: char 5, line 1

と比較した各ファイルパスとどの部分が異なるのかを標準出力に出力してくれます。
また差の有無によってステータスコードが異なります。差があった場合は、`exit status = 1`、差がなかった場合は `exit status = 0`です。標準出力の仕様がいまいち分からないので、差の有無の判断は`exit status`で判断するのが普通なのかなと思います。



# 2つのディレクトリにある全ファイルをバイト単位で比較する

使用例として、2つのディレクトリにある同じ名前のファイル同士を比較し、差があるときだけメッセージを出すbashスクリプトを書いてみます。差の有無の判断は、`exit status`で行っています。

```bash
#! /bin/bash
# 2つのディレクトリにある同じ名前のファイル同士を比較し、差があるときだけメッセージを出す

dir1=src1/  # １つ目のディレクトリ
dir2=src2/  # ２つ目のディレクトリ

fpaths=${dir1}*  # 第１ディレクトリの全ファイルパスを取得

# ファイルパスをループ
i=0
for f1path in $fpaths; do
  fnm=`basename $f1path`
  # echo $fnm
  f2path=${dir2}${fnm}
  cmt=`cmp $f1path $f2path`  # ２つのファイルを比較
  if [ $? -eq 1 ]; then
    echo $cmt  # 差があった場合は、メッセージを表示
    i=$(( $i + 1 ))  # 差があったファイル数をカウントしておく
  fi
done

# 差が１つもなかった場合はその旨を表示
if [ $i -eq 0 ]; then
  echo 'All file pairs are the same.'
fi

```

コードは[こちら](https://gist.github.com/messefor/041eb08aeaed937c59b2d07de8995c88)にあります。

---

shellとかRとかWeb系とか、少し触らないとすぐに忘れてしまいます。中年になると、栓が抜けた湯船のように、蛇口から入ってくる水より多くの水が抜けていきますね。そのうちスッカラカンになりそうな予感。日々精進